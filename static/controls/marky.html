<templates>

<div xTemplate='markygen'>
<form xForm=marky method=post action='/markygen.js'>
<input type=hidden name=c value=#cookie>
<field #name=subject #title=Subject: #titlewidth=100 #valuewidth=420></field>
<div class=cl></div>
<div class=fl style='width: 100px'>Text:</div>
<div class=line style='min-height: 240px'>
<textarea rows=5 cols=57 name=text></textarea>
</div>
<div class=cl></div>
<div class=line>
<div class=formbtn>Send</div>
</div>
</form>
</div>

<div xTemplate='markylist'>
Enable output:
<div xDataname=ais xSocket='/markers.json'></div>
<form xForm=ai>
<select xLoop=ais xKey=ainame xVal=aiee name=ai onchange=UpdateMarkers()>
 <option value=#ainame>#aiee</option>
</select>
</form>
</div>

<div xTemplate='marky'>
<div class=fl>#m</div>
<div class=cl></div>
<div xDataname='marky.#m' xUrl='/marky.js?c=#cookie&m=#m' xRefresh=20 xCb=UpdateMarker></div>

<div xWatch='marky.#m'>
<div xLoop=marky.#m xKey=k xVal=v>
<div class=fl>#v</div>
<div class=cl></div>
</div>
</div>

</div>

</templates>

<script language=javascript>

var markers = {};

function UpdateMarker(row,req)
{
	if( row == null ) return;
	console.info(row,req);
	var radRows = radVar(req.title);
	if( radRows == null ) {
		radStore(req.title, [row]);
	} else {
		radRows.push(row);
		if( radRows.length > 30 ) {
			radRows.shift();
		}
		radChange(req.title);
	}
}
function UpdateMarkers()
{
    var si = document.forms.ai.ai;
    var i, siv, found=false;
    while( !found ) {
        found=true;
        for( i in markers ) {
            if( !si.options[i].checked ) {
                delete markers[i];
                found=false;
                break;
            }
        }
    };
    found = false;
    for( i=0; i < si.options.length; i++ ) {
        if( si.options[i].checked && !(i in markers) ) {
            siv = si.options[i].value;
            var o = { 'socket': '/marky.json?by=' + siv };
            radType('aitext.' + siv, o );
            markers[i] = true;
            found = true;
        }
    }
}
</script>
