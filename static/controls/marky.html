<templates>

<div xTemplate='markygen'>
<form xForm=marky method=post action='/markygen.js'>
<field #name=subject #title=Subject: #titlewidth=100 #valuewidth=420></field>
<div class=cl></div>
<div class=fl style='width: 100px'>Text:</div>
<div class=line style='min-height: 240px'>
<textarea rows=5 cols=57 name=text></textarea>
</div>
<div class=cl></div>
<div class=line>
<input type=submit value=Send>
</div>
</form>
</div>

<div xTemplate='marky'>
Enable output:
<div xDataname=ais xSocket='/markers.json'></div>
<form xForm=ai>
<select xLoop=ais xKey=ainame xVal=aiee name=ai onchange=UpdateMarkers()>
 <option value=#ainame>#aiee</option>
</select>
</form>
</div>

</templates>

<script language=javascript>

var markers = {};

function UpdateMarkers()
{
    var si = document.forms.ai.ai;
    var i, siv, found=false;
    while( !found ) {
        found=true;
        for( i in markers ) {
            if( !si.options[i].checked ) {
                delete markers[i];
                found=false;
                break;
            }
        }
    };
    found = false;
    for( i=0; i < si.options.length; i++ ) {
        if( si.options[i].checked && !(i in markers) ) {
            siv = si.options[i].value;
            var o = { 'socket': '/marky.json?by=' + siv };
            radType('aitext.' + siv, o );
            markers[i] = true;
            found = true;
        }
    }
}
</script>
